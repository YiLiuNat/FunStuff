<!DOCTYPE html><html class="appearance-light" lang="en"><head><meta charset="UTF-8"><title>关于iScroll和React结合的可行性方案</title><meta name="description" content="Life is full of fun and I will share some of fun stuff to you."><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="
前言这两天试了下React和iScroll结合的事情，坑还是挺多的。注意这里说的是iScroll5 非react-iscroll。网上关于这个的讨论也还是有个两三条，我找到了两个成功案例，但关于AMD报错的问题却无人提及，外网上也是没什么人讨论这个。
AMD报错首先第一步导入iScroll就出现问题:import iScroll from ‘./lib/iscroll’;
导入后React会报错，提示iScroll.js里面最后两行有个define is not defined。这是关于异步amd的错误，研究一阵后发觉这个并不是我想要的东西，随即仔细看了下这一段的语法，且抱着试试的心态将iScroll中最后一段（2162行-2168行）修改为如下：
if ( typeof module != &amp;#39;u.."><meta name="generator" content="Hexo 5.4.0"></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Yi Liu's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">关于iScroll和React结合的可行性方案</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a target="_blank" rel="noopener" href="https://yiliu.tech">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a target="_blank" rel="noopener" href="https://yiliu.tech">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AMD%E6%8A%A5%E9%94%99"><span class="toc-text">AMD报错</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8React%E6%8F%92%E5%85%A5iScroll"><span class="toc-text">如何在React插入iScroll</span></a></li></ol></div><div class="column is-9"><header class="my-4"></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">关于iScroll和React结合的可行性方案</h1><time class="has-text-grey" datetime="2021-03-29T12:44:07.000Z">2021-03-29</time><article class="mt-2 post-content"><p><img src="https://funstuff.design/images/blog_img/nasa-min.jpg" alt="FlytoTheReactSky"></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这两天试了下React和iScroll结合的事情，坑还是挺多的。注意这里说的是iScroll5 非react-iscroll。网上关于这个的讨论也还是有个两三条，我找到了两个成功案例，但关于AMD报错的问题却无人提及，外网上也是没什么人讨论这个。</p>
<h2 id="AMD报错"><a href="#AMD报错" class="headerlink" title="AMD报错"></a>AMD报错</h2><p>首先第一步导入iScroll就出现问题:<br>import iScroll from ‘./lib/iscroll’;</p>
<p>导入后React会报错，提示iScroll.js里面最后两行有个define is not defined。这是关于异步amd的错误，研究一阵后发觉这个并不是我想要的东西，随即仔细看了下这一段的语法，且抱着试试的心态将iScroll中最后一段（2162行-2168行）修改为如下：</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #0000aa">if</span> ( <span style="color: #0000aa">typeof</span> module != <span style="color: #aa5500">&#39;undefined&#39;</span> &amp;&amp; module.exports ) {
    module.exports = IScroll;
} <span style="color: #0000aa">else</span> {
    <span style="color: #00aaaa">window</span>.IScroll = IScroll;
}
</pre></div>

<p>于是amd报错的问题就这么解决了。</p>
<p>&nbsp;</p>
<h2 id="如何在React插入iScroll"><a href="#如何在React插入iScroll" class="headerlink" title="如何在React插入iScroll"></a>如何在React插入iScroll</h2><p>总体思路是在React加载后再载入iScroll<br>因此在<strong>需要滚动的React组件</strong>中创建componentDidMount()具体如下</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">    componentDidMount() {
        <span style="color: #aaaaaa; font-style: italic">//加载iScroll插件</span>
        <span style="color: #0000aa">const</span> options = {
            preventDefault: <span style="color: #0000aa">false</span>,<span style="color: #aaaaaa; font-style: italic">// 默认iscroll会拦截元素的默认事件处理函数，我们需要响应onClick，因此要配置</span>
            zoom: <span style="color: #0000aa">false</span>,<span style="color: #aaaaaa; font-style: italic">// 禁止缩放</span>
            mouseWheel: <span style="color: #0000aa">true</span>,<span style="color: #aaaaaa; font-style: italic">// 支持鼠标滚轮</span>
            probeType: <span style="color: #009999">3</span>,<span style="color: #aaaaaa; font-style: italic">// 滚动事件的探测灵敏度，1-3，越高越灵敏，兼容性越好，性能越差</span>
            bounce: <span style="color: #0000aa">true</span>, <span style="color: #aaaaaa; font-style: italic">// 拖拽超过上下界后出现弹射动画效果</span>
            scrollbars: <span style="color: #0000aa">false</span>,<span style="color: #aaaaaa; font-style: italic">// 展示滚动条</span>
        };
        setTimeout(<span style="color: #0000aa">function</span> () {<span style="color: #aaaaaa; font-style: italic">//由于手机性能的原因，我们在定时器里面进行实例化</span>
          <span style="color: #0000aa">this</span>.myScroll = <span style="color: #0000aa">new</span> iScroll(<span style="color: #aa5500">&quot;#projectSection&quot;</span>,options);  
        },<span style="color: #009999">10</span>);
        setTimeout(<span style="color: #0000aa">function</span>() {
            <span style="color: #0000aa">this</span>.myScroll.refresh();
        },<span style="color: #009999">100</span>);
    }
</pre></div></article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><em></em><a class="button is-default" href="/2021/03/29/%E8%AE%B0%E4%B8%80%E4%BA%9BHexo%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%AF%AD%E6%B3%95/" title="记一些Hexo的命令行语法"><span class="has-text-weight-semibold">Next: 记一些Hexo的命令行语法</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="YiLiuNat/FunStuff" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/YiLiuNat"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com/yiliu_nat"><i class="iconfont icon-ins"></i></a><!-- RSS--><!-- 知乎--><!-- 领英--><a title="linkedin" target="_blank" rel="noopener nofollow" href="//www.linkedin.com/in/yi-liu-career"><i class="iconfont icon-linkedin"></i></a><!-- 脸书--></section><p><span>Copyright ©</span><span> Yi Liu 2021</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo</p></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>